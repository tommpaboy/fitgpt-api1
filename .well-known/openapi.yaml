openapi: 3.1.0

info:
  title: FitGPT API
  version: "1.5.0"
  description: |
    End-points för Fitbit-data samt manuellt loggade måltider & träningspass.

servers:
  - url: https://fitgpt-2364.onrender.com

paths:
  /daily-summary:
    get:
      summary: Samlad dagsdata (Fitbit + Firestore)
      operationId: getDailySummary
      parameters:
        - in: query
          name: target_date
          description: YYYY-MM-DD (default = idag)
          schema: {type: string, format: date}
        - in: query
          name: fresh
          description: true → hoppa cache
          schema: {type: boolean}
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/GenericObject'}
      x-openai-isConsequential: false

  /data/extended/full:
    get:
      summary: Fitbit + Firestore för flera dagar
      operationId: getExtendedFull
      parameters:
        - in: query
          name: days
          schema: {type: integer, minimum: 1, default: 1}
        - in: query
          name: fresh
          schema: {type: boolean}
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/GenericObject'}
      x-openai-isConsequential: false

  # ───────────── MÅLTIDER ─────────────────────────
  /log/meal:
    post:
      summary: Logga måltid
      operationId: postMeal
      requestBody:
        required: true
        content:
          application/json:
            schema: {$ref: '#/components/schemas/MealLog'}
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/GenericObject'}
      x-openai-isConsequential: true
    get:
      summary: Hämta måltider för datum
      operationId: getMeals
      parameters:
        - in: query
          name: date
          required: true
          schema: {type: string, format: date}
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: {$ref: '#/components/schemas/MealLog'}
      x-openai-isConsequential: false

  /log/meal/{id}:
    put:
      summary: Uppdatera måltid
      operationId: putMeal
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      requestBody:
        required: true
        content:
          application/json:
            schema: {$ref: '#/components/schemas/MealLog'}
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/GenericObject'}
      x-openai-isConsequential: true
    delete:
      summary: Ta bort måltid
      operationId: deleteMeal
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/GenericObject'}
      x-openai-isConsequential: true

  # ────────── TRÄNINGSPASS ────────────────────────
  /log/workout:
    post:
      summary: Logga träningspass
      operationId: postWorkout
      requestBody:
        required: true
        content:
          application/json:
            schema: {$ref: '#/components/schemas/WorkoutLog'}
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/GenericObject'}
      x-openai-isConsequential: true
    get:
      summary: Hämta pass för datum
      operationId: getWorkouts
      parameters:
        - in: query
          name: date
          required: true
          schema: {type: string, format: date}
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: {$ref: '#/components/schemas/WorkoutLog'}
      x-openai-isConsequential: false

  /log/workout/{id}:
    put:
      summary: Uppdatera träningspass
      operationId: putWorkout
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      requestBody:
        required: true
        content:
          application/json:
            schema: {$ref: '#/components/schemas/WorkoutLog'}
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/GenericObject'}
      x-openai-isConsequential: true
    delete:
      summary: Ta bort träningspass
      operationId: deleteWorkout
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: {$ref: '#/components/schemas/GenericObject'}
      x-openai-isConsequential: true

components:
  schemas:
    GenericObject:
      type: object
      additionalProperties: true

    MealLog:
      type: object
      required: [date, meal, items]
      properties:
        date:   {type: string, format: date}
        meal:   {type: string}
        items:  {type: string}
        estimated_calories: {type: integer}

    WorkoutLog:
      type: object
      required: [date, workout_type, details]
      properties:
        date:        {type: string, format: date}
        workout_type:{type: string}
        details:     {type: string}
        start_time:  {type: string, format: date-time, description: ISO-datumtid (YYYY-MM-DDTHH:MM:SS)}
