openapi: 3.1.0

info:
  title: FitGPT API
  version: "1.4.0"
  description: End-points för Fitbit-data samt manuellt loggade måltider & träningspass.

servers:
  - url: https://fitgpt-2364.onrender.com

paths:
  /daily-summary:
    get:
      summary: Samlad dagsdata (Fitbit + Firestore)
      operationId: getDailySummary
      parameters:
        - name: date          # ex. 2025-07-02
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: fresh         # true = hoppa cache
          in: query
          required: false
          schema:
            type: boolean
      responses:
        "200":
          description: Dagsdata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericObject'
      x-openai-isConsequential: false

   /data/extended/full:
    get:
      summary: Fitbit + Firestore för flera dagar
      operationId: getExtendedFull
      parameters:
        - name: days
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: fresh
          in: query
          required: false
          schema:
            type: boolean
      responses:
        "200":
          description: Datum-nycklad intervall-data
          content:
            application/json:
              schema:
                type: object
                properties:
                  from: {type: string, format: date}
                  to:   {type: string, format: date}
                  days:
                    type: object
                    additionalProperties:
                      $ref: '#/components/schemas/GenericObject'
      x-openai-isConsequential: false


  # ──────────────── MÅLTIDER ──────────────────────────────
  /log/meal:
    post:
      summary: Logga måltid
      operationId: postMeal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MealLog'
      responses:
        "200":
          description: Sparad post
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericObject'
      x-openai-isConsequential: true

    get:
      summary: Hämta måltider för datum
      operationId: getMeals
      parameters:
        - name: date
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Lista av måltider
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MealLog'
      x-openai-isConsequential: false

  /log/meal/{id}:
    put:
      summary: Uppdatera en måltid
      operationId: putMeal
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MealLog'
      responses:
        "200":
          description: Uppdaterad post
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericObject'
      x-openai-isConsequential: true

    delete:
      summary: Ta bort en måltid
      operationId: deleteMeal
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Borttagen post
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericObject'
      x-openai-isConsequential: true

  # ──────────────── TRÄNINGSPASS ──────────────────────────
  /log/workout:
    post:
      summary: Logga träningspass
      operationId: postWorkout
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkoutLog'
      responses:
        "200":
          description: Sparad post
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericObject'
      x-openai-isConsequential: true

    get:
      summary: Hämta pass för datum
      operationId: getWorkouts
      parameters:
        - name: date
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Lista av pass
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WorkoutLog'
      x-openai-isConsequential: false

  /log/workout/{id}:
    put:
      summary: Uppdatera ett träningspass
      operationId: putWorkout
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkoutLog'
      responses:
        "200":
          description: Uppdaterad post
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericObject'
      x-openai-isConsequential: true

    delete:
      summary: Ta bort ett träningspass
      operationId: deleteWorkout
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Borttagen post
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericObject'
      x-openai-isConsequential: true

components:
  schemas:
    GenericObject:
      type: object
      description: Valfritt JSON-objekt
      properties: {}
      additionalProperties: true

    MealLog:
      type: object
      required: [date, meal, items]
      properties:
        date:
          type: string
          format: date
        meal:
          type: string
        items:
          type: string
        estimated_calories:
          type: integer

    WorkoutLog:
      type: object
      required: [date, workout_type, details]
      properties:
        date:
          type: string
          format: date
        workout_type:
          type: string
        details:
          type: string
